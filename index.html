<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>For Apoorva | My Bestie</title>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;1,400&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    /* --- VISUAL VARIABLES & THEMES --- */
    :root {
      /* Default: Cozy Cream */
      --primary: #6d4c41;
      --secondary: #8d6e63;
      --accent: #d4a373;
      --bg: #fefae0;
      --card-bg: #ffffff;
      --text: #333d29;
      --highlight: #faedcd;
      --success: #ccd5ae;
      --danger: #e76f51;
      --font-body: 'Montserrat', sans-serif;
      --font-heading: 'Playfair Display', serif;
      --font-script: 'Dancing Script', cursive;
    }

    [data-theme="pastel"] {
      --primary: #b5838d;
      --secondary: #e5989b;
      --accent: #ffb4a2;
      --bg: #fff0f3;
      --card-bg: #ffffff;
      --text: #6d6875;
      --highlight: #ffcdb2;
      --success: #b7e4c7;
      --danger: #ef476f;
    }

    [data-theme="matcha"] {
      --primary: #588157;
      --secondary: #3a5a40;
      --accent: #a3b18a;
      --bg: #f1f8e9;
      --card-bg: #ffffff;
      --text: #344e41;
      --highlight: #dad7cd;
      --success: #99d98c;
      --danger: #bc4749;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background-color: var(--bg);
      color: var(--text);
      font-family: var(--font-body);
      transition: background-color 0.8s ease, color 0.5s ease;
      overflow-x: hidden;
      cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23d4a373' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z'></path></svg>") 10 10, auto;
    }

    /* --- UTILITIES --- */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    .section {
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 60px 20px;
      position: relative;
    }

    .card {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.08);
      border: 4px solid var(--highlight);
      transition: transform 0.3s ease;
    }

    .card:hover { transform: translateY(-5px); }

    h1 { font-family: var(--font-script); font-size: 4rem; margin: 0; color: var(--primary); }
    h2 { font-family: var(--font-heading); font-size: 2.5rem; margin-bottom: 20px; color: var(--secondary); }
    p { font-size: 1.1rem; line-height: 1.6; }

    /* --- BUTTONS --- */
    .btn {
      padding: 15px 35px;
      border: none;
      border-radius: 50px;
      font-family: var(--font-body);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .btn:hover { transform: scale(1.05) rotate(-2deg); }
    .btn:active { transform: scale(0.95); }

    .btn-primary { background: var(--primary); color: white; }
    .btn-accent { background: var(--accent); color: white; }
    .btn-success { background: var(--success); color: var(--text); }
    .btn-danger { background: var(--danger); color: white; }

    /* --- THEME TOGGLE --- */
    .theme-switcher {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      gap: 10px;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 50px;
      backdrop-filter: blur(5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .theme-dot {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: transform 0.2s;
    }
    .theme-dot:hover { transform: scale(1.2); }
    .theme-dot[data-set="default"] { background: #6d4c41; }
    .theme-dot[data-set="pastel"] { background: #b5838d; }
    .theme-dot[data-set="matcha"] { background: #588157; }

    /* --- HEADER --- */
    .header-quote {
      position: relative;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(4px);
      padding: 40px;
      border-radius: 30px;
      margin-top: 30px;
      max-width: 600px;
    }
    .header-quote span.highlight {
      background: var(--highlight);
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: bold;
    }

    /* --- MOOD PET --- */
    .pet-container {
      font-size: 8rem;
      margin: 20px 0;
      animation: float 4s ease-in-out infinite;
      transition: all 0.5s ease;
      cursor: pointer;
    }
    .pet-container:hover { transform: scale(1.1); }
    #pet-message {
      font-weight: 600;
      color: var(--primary);
      min-height: 1.5em;
    }

    /* --- TIMELINE --- */
    .timeline {
      position: relative;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px 0;
    }
    .timeline::before {
      content: '';
      position: absolute;
      top: 0; bottom: 0; left: 50%;
      width: 4px;
      background: var(--accent);
      border-radius: 2px;
      transform: translateX(-50%);
    }
    .memory-node {
      position: relative;
      margin: 40px 0;
      width: 50%;
      padding: 0 30px;
    }
    .memory-node:nth-child(odd) { left: 0; text-align: right; }
    .memory-node:nth-child(even) { left: 50%; text-align: left; }

    .memory-content {
      background: white;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      position: relative;
    }
    .memory-node:nth-child(odd) .memory-content { border-right: 4px solid var(--primary); }
    .memory-node:nth-child(even) .memory-content { border-left: 4px solid var(--primary); }

    .memory-dot {
      position: absolute;
      top: 20px;
      width: 20px;
      height: 20px;
      background: var(--primary);
      border-radius: 50%;
      border: 4px solid white;
    }
    .memory-node:nth-child(odd) .memory-dot { right: -40px; }
    .memory-node:nth-child(even) .memory-dot { left: -40px; }

    /* --- FIX SHASHWAT SLIDERS --- */
    .slider-group {
      width: 100%;
      max-width: 400px;
      margin: 15px 0;
    }
    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-weight: 600;
      font-size: 0.9rem;
    }
    input[type=range] {
      width: 100%;
      -webkit-appearance: none;
      background: transparent;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 24px;
      width: 24px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      margin-top: -10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 6px;
      cursor: pointer;
      background: var(--highlight);
      border-radius: 5px;
    }

    /* --- HARKATE GAME --- */
    #harkate-area {
      position: relative;
      width: 100%;
      max-width: 600px;
      height: 300px;
      background: var(--card-bg);
      border: 4px dashed var(--accent);
      border-radius: 30px;
      overflow: hidden;
      margin-bottom: 20px;
      cursor: crosshair;
    }
    .bubble {
      position: absolute;
      background: var(--danger);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      animation: floatUp 3s ease-in forwards;
      cursor: pointer;
    }

    /* --- ANIMATIONS --- */
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    @keyframes floatUp { 0% { opacity: 0; transform: scale(0.5); } 10% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: translateY(-100px); } }

    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 1s ease forwards; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* --- RESPONSIVE --- */
    @media (max-width: 600px) {
      h1 { font-size: 3rem; }
      .timeline::before { left: 20px; }
      .memory-node { width: 100%; padding-left: 50px; padding-right: 0; text-align: left; }
      .memory-node:nth-child(odd), .memory-node:nth-child(even) { left: 0; }
      .memory-dot { left: -40px !important; }
      .memory-content { border: none !important; border-left: 4px solid var(--primary) !important; }
    }
  </style>
</head>
<body data-theme="default">

  <!-- Theme Switcher -->
  <div class="theme-switcher">
    <div class="theme-dot" data-set="default" title="Cozy Cream"></div>
    <div class="theme-dot" data-set="pastel" title="Soft Pastel"></div>
    <div class="theme-dot" data-set="matcha" title="Matcha Cute"></div>
  </div>

  <!-- HEADER -->
  <section class="section" id="home">
    <i data-lucide="heart" class="icon-lg" style="color:var(--primary); width: 48px; height: 48px; margin-bottom: 20px;"></i>
    <p style="letter-spacing: 3px; font-size: 0.8rem; text-transform: uppercase;">Shashwat Gupta Says...</p>
    <h1>I'm Sorry, Apoorva.</h1>
    
    <div class="header-quote">
      <p>"Apoorva, you're <span class="highlight">5'5"</span>, dusky, and the most patient person I know. 
      I know my <span class="highlight">5'8"</span> self does way too many <strong>harkate</strong>‚Äîit's just in my nature, 
      but it's never my intention to upset you. When you're not happy, my world feels grayscale. 
      <br><br><strong>Can we go back to being besties?</strong>"</p>
    </div>
    
    <p style="margin-top: 40px; opacity: 0.6; font-style: italic; font-size: 0.9rem;">Scroll down... I made this for you.</p>
  </section>

  <!-- MOOD PET -->
  <section class="section" style="background: rgba(255,255,255,0.3);">
    <h2>How is the bestie feeling?</h2>
    <p>This little Mood Pet mimics you. Click a button to change the vibe.</p>
    
    <div class="pet-container" id="mood-pet">
      ( ‚ó°ÃÅ.‚ó°ÃÄ)
    </div>
    <p id="pet-message">I'm waiting...</p>

    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; justify-content: center;">
      <button class="btn btn-primary" onclick="setMood('Sad')">
        <i data-lucide="frown"></i> I'm Upset/Sad
      </button>
      <button class="btn btn-accent" onclick="setMood('Happy')">
        <i data-lucide="smile"></i> I'm Okay/Happy
      </button>
    </div>
  </section>

  <!-- MEMORY TIMELINE -->
  <section class="section">
    <h2>Our Memory Lane</h2>
    <div class="timeline">
      <div class="memory-node">
        <div class="memory-dot"></div>
        <div class="memory-content">
          <h4>The Beginning</h4>
          <p>The day we became friends and realized we share the same brain cell.</p>
        </div>
      </div>
      <div class="memory-node">
        <div class="memory-dot"></div>
        <div class="memory-content">
          <h4>First Inside Joke</h4>
          <p>That random thing we laughed at for 20 minutes straight.</p>
        </div>
      </div>
      <div class="memory-node">
        <div class="memory-dot"></div>
        <div class="memory-content">
          <h4>That One Fight</h4>
          <p>I was annoying, you were patient. Classic us.</p>
        </div>
      </div>
      <div class="memory-node">
        <div class="memory-dot"></div>
        <div class="memory-content">
          <h4>Today</h4>
          <p>Me asking for forgiveness with a coded website.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FIX SHASHWAT -->
  <section class="section" style="background: rgba(255,255,255,0.4);">
    <h2>Fix Your Bestie üõ†Ô∏è</h2>
    <p>Drag the sliders to fix my personality.</p>

    <div class="card" style="width: 100%; max-width: 500px;">
      <div class="slider-group">
        <div class="slider-label"><span>Overthinking</span> <span>100%</span></div>
        <input type="range" min="0" max="100" value="100" class="fix-slider" data-type="Overthinking">
      </div>
      
      <div class="slider-group">
        <div class="slider-label"><span>Annoying Jokes</span> <span>95%</span></div>
        <input type="range" min="0" max="100" value="95" class="fix-slider" data-type="Jokes">
      </div>

      <div class="slider-group">
        <div class="slider-label"><span>Ego</span> <span>80%</span></div>
        <input type="range" min="0" max="100" value="80" class="fix-slider" data-type="Ego">
      </div>

      <p id="fix-feedback" style="font-size: 0.9rem; margin-top: 15px; color: var(--danger); font-weight: bold; min-height: 1.2em;"></p>
    </div>
  </section>

  <!-- COMPLIMENT GENERATOR -->
  <section class="section">
    <h2>Need Reassurance?</h2>
    <button class="btn btn-accent" id="compliment-btn" style="padding: 20px 40px; font-size: 1.2rem;">
      <i data-lucide="sparkles"></i> Tell me a truth
    </button>
    <div id="compliment-display" class="card hidden" style="margin-top: 30px; animation: float 3s infinite;">
      <p style="font-size: 1.5rem; font-family: var(--font-script); color: var(--primary);">You are beautiful!</p>
    </div>
  </section>

  <!-- HARKATE GAME -->
  <section class="section" style="background: var(--bg);">
    <h2>Pop The "Harkate"</h2>
    <p>Click the bubbles to make my annoying habits vanish!</p>
    <div id="harkate-area"></div>
    <p>Harkate Removed: <span id="score" style="font-size: 1.5rem; font-weight: bold; color: var(--accent);">0</span></p>
  </section>

  <!-- FINAL VERDICT -->
  <section class="section" style="background: var(--primary); color: white;">
    <h2 style="color: white;">Final Verdict?</h2>
    <p style="color: rgba(255,255,255,0.8);">Will you forgive your annoying 5'8" bestie?</p>
    
    <div style="display: flex; gap: 20px; margin-top: 40px; position: relative; height: 100px; width: 100%; justify-content: center;">
      <button class="btn btn-success" onclick="forgive()">
        <i data-lucide="check"></i> Yes, Bestie!
      </button>
      
      <button class="btn btn-danger" id="no-btn" onmouseover="evolveNoButton()" onclick="evolveNoButton()">
        <i data-lucide="x"></i> No
      </button>
    </div>
  </section>

  <!-- SUCCESS SCREEN (Hidden by default) -->
  <div id="success-screen" class="section hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000;">
    <h1 style="font-size: 5rem;">‚ù§Ô∏è Forgiven! ‚ù§Ô∏è</h1>
    <p style="margin-top: 20px;">Thank you, Apoorva. You're actually the best human being alive.</p>
    <p style="font-size: 0.9rem; opacity: 0.6;">(I promise to keep the harkate score low tomorrow)</p>
  </div>

  <script>
    // --- 1. FIREBASE SETUP (Legacy v8) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBIyIXYNvVhJnSK58rB29K9n7SNnbaoqnc",
      authDomain: "proposal-apoorva-sarvagy.firebaseapp.com",
      databaseURL: "https://proposal-apoorva-sarvagy-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "proposal-apoorva-sarvagy",
      storageBucket: "proposal-apoorva-sarvagy.firebasestorage.app",
      messagingSenderId: "794226715688",
      appId: "1:794226715688:web:284222db7af709b2cd591d",
      measurementId: "G-BZ4R12MR9T"
    };

    let db;
    let sessionId = "session_" + Date.now();
    let sessionData = {
      name: "Apoorva Maurya",
      startTime: new Date().toLocaleString(),
      mood: "Not selected",
      harkateScore: 0,
      finalDecision: "Pending",
      noButtonAttempts: 0
    };

    // Initialize Firebase
    if (typeof firebase !== 'undefined') {
      firebase.initializeApp(firebaseConfig);
      db = firebase.database();
      syncData();
    }

    function updateSession(key, value) {
      sessionData[key] = value;
      syncData();
    }

    function syncData() {
      if(db) db.ref('apology_responses/' + sessionId).set(sessionData);
    }

    // --- 2. THEME SWITCHER ---
    const themeDots = document.querySelectorAll('.theme-dot');
    themeDots.forEach(dot => {
      dot.addEventListener('click', () => {
        const theme = dot.getAttribute('data-set');
        document.body.setAttribute('data-theme', theme);
      });
    });

    // --- 3. MOOD PET LOGIC ---
    const pet = document.getElementById('mood-pet');
    const petMsg = document.getElementById('pet-message');
    const body = document.body;

    function setMood(mood) {
      updateSession('mood', mood);
      if (mood === 'Sad') {
        pet.innerText = '(ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°)';
        petMsg.innerText = "Oh no... I'm turning gray.";
        body.style.filter = "grayscale(100%) sepia(20%)";
        pet.style.animation = "none";
      } else {
        pet.innerText = '‚ú®(‚óï‚Äø‚óï)‚ú®';
        petMsg.innerText = "Yay! Color is back!";
        body.style.filter = "none";
        pet.style.animation = "float 3s infinite ease-in-out";
        
        // Tiny confetti pop
        confetti({
          particleCount: 50,
          spread: 60,
          origin: { y: 0.7 }
        });
      }
    }

    // --- 4. FIX SHASHWAT SLIDERS ---
    const sliders = document.querySelectorAll('.fix-slider');
    const feedback = document.getElementById('fix-feedback');
    const feedbacks = [
      "Processing request... Error 404.",
      "Personality is hard-coded, cannot change.",
      "Trying really hard...",
      "System Overload! Too much ego.",
      "Downloading 'Better Personality'..."
    ];

    sliders.forEach(slider => {
      slider.addEventListener('input', (e) => {
        // Visual update of percentage
        e.target.previousElementSibling.children[1].innerText = e.target.value + '%';
        // Random feedback
        feedback.innerText = feedbacks[Math.floor(Math.random() * feedbacks.length)];
      });
    });

    // --- 5. COMPLIMENT GENERATOR ---
    const compliments = [
      "You have the best smile ‚ú®",
      "Fashion Icon üëó",
      "Smartest Cookie üç™",
      "Most Patient Queen üëë",
      "Best Listener üëÇ",
      "Secretly a Genius üß†",
      "Dusk Beauty üåô",
      "Literally an Angel üëº"
    ];
    const compBtn = document.getElementById('compliment-btn');
    const compDisplay = document.getElementById('compliment-display');

    compBtn.addEventListener('click', () => {
      const random = compliments[Math.floor(Math.random() * compliments.length)];
      compDisplay.classList.remove('hidden');
      compDisplay.querySelector('p').innerText = random;
      confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } });
    });

    // --- 6. HARKATE GAME ---
    const phrases = ["Annoying Joke", "Bad Logic", "Random Text", "Late Reply", "Height Flex", "Sarcasm"];
    let score = 0;
    const gameArea = document.getElementById('harkate-area');

    function spawnBubble() {
      const b = document.createElement('div');
      b.className = 'bubble';
      b.innerText = phrases[Math.floor(Math.random() * phrases.length)];
      b.style.left = Math.random() * 80 + '%';
      b.style.bottom = '-50px'; // Start below
      
      b.onclick = (e) => {
        e.stopPropagation(); // prevent triggering game area click
        score++;
        document.getElementById('score').innerText = score;
        updateSession('harkateScore', score);
        b.remove();
        // small sound or visual effect here
      };
      
      gameArea.appendChild(b);
      
      // Clean up after animation
      setTimeout(() => { if(b.parentElement) b.remove(); }, 3000);
    }

    // Start game loop
    setInterval(spawnBubble, 1000);

    // --- 7. EVOLVING NO BUTTON ---
    const noBtn = document.getElementById('no-btn');
    let noAttempts = 0;

    function evolveNoButton() {
      noAttempts++;
      updateSession('noButtonAttempts', noAttempts);
      
      if (noAttempts < 3) {
        // Run away
        const x = Math.random() * 200 - 100;
        const y = Math.random() * 100 - 50;
        noBtn.style.transform = `translate(${x}px, ${y}px)`;
      } else if (noAttempts === 3) {
        noBtn.style.transform = 'translate(0,0)';
        noBtn.innerHTML = '<i data-lucide="help-circle"></i> Maybe?';
        noBtn.classList.remove('btn-danger');
        noBtn.style.background = '#f4a261'; // Orange
      } else if (noAttempts === 4) {
        noBtn.innerHTML = '<i data-lucide="meh"></i> Okay fine...';
        noBtn.style.background = '#e9c46a'; // Yellow
      } else if (noAttempts >= 5) {
        noBtn.innerHTML = '<i data-lucide="check"></i> Yes! (Idiot)';
        noBtn.classList.add('btn-success');
        noBtn.onclick = forgive; // Override onclick
      }
      
      lucide.createIcons(); // Refresh icons
    }

    // --- 8. SUCCESS ---
    function forgive() {
      updateSession('finalDecision', 'Forgiven ‚ù§Ô∏è');
      document.getElementById('success-screen').classList.remove('hidden');
      document.getElementById('success-screen').classList.add('fade-in');
      
      const duration = 3 * 1000;
      const animationEnd = Date.now() + duration;
      const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 3000 };

      const randomInRange = (min, max) => Math.random() * (max - min) + min;

      const interval = setInterval(function() {
        const timeLeft = animationEnd - Date.now();

        if (timeLeft <= 0) {
          return clearInterval(interval);
        }

        const particleCount = 50 * (timeLeft / duration);
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
      }, 250);
    }

    // Initialize Lucide icons on load
    lucide.createIcons();
  </script>
</body>
</html>
