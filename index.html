<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Apoorva | My Bestie</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root {
            --primary: #6d4c41; /* Earthy Brown */
            --accent: #d4a373;  /* Warm Dusk/Gold */
            --bg: #fefae0;      /* Vintage Cream */
            --text: #333d29;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            transition: filter 1s ease;
        }

        .grayscale { filter: grayscale(100%) sepia(20%); }

        /* Smooth scroll effect */
        html { scroll-behavior: smooth; }

        /* Section Styling */
        header, section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
        }

        h1 { font-family: 'Dancing Script', cursive; font-size: clamp(3rem, 10vw, 5rem); color: var(--primary); margin: 0; }
        h2 { font-family: 'Playfair Display', serif; font-size: 2.2rem; margin-bottom: 20px; }

        .quote-block {
            max-width: 800px;
            font-size: 1.1rem;
            line-height: 1.8;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.4);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.05);
            position: relative;
        }

        .quote-block::before { content: "“"; font-size: 5rem; position: absolute; left: 10px; top: -10px; opacity: 0.1; }

        /* Polaroid Gallery */
        .polaroid-container {
            position: relative;
            width: 100%;
            max-width: 1100px;
            height: 800px;
            margin: 50px auto;
        }

        .polaroid {
            background: white;
            padding: 15px 15px 45px 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: absolute;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 200px;
        }

        .polaroid img { width: 100%; height: 200px; object-fit: cover; }
        .polaroid:hover { transform: scale(1.1) rotate(0deg) !important; z-index: 100; }

        /* Game UI */
        .game-area {
            background: #faedcd;
            width: 90%;
            max-width: 700px;
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
        }

        #harkate-canvas {
            width: 100%;
            height: 250px;
            background: #fff;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--accent);
        }

        .h-bubble {
            position: absolute;
            background: var(--primary);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: crosshair;
            animation: float 3s infinite ease-in-out;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Decision Section */
        .decision-section { background: var(--primary); color: white; position: relative; }
        .btn-wrap { position: relative; width: 300px; height: 120px; margin-top: 40px; }
        .choice-btn {
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            position: absolute;
            font-size: 1.1rem;
        }
        #yesBtn { background: #ccd5ae; color: #333d29; left: 0; }
        #noBtn { background: #e76f51; color: white; right: 0; }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .polaroid-container { height: 1200px; }
            .polaroid { width: 150px; padding: 10px 10px 30px 10px; }
        }
    </style>
</head>
<body id="pageBody">

    <!-- Header & Personal Note -->
    <header>
        <p style="letter-spacing: 3px;">SHASHWAT GUPTA SAYS...</p>
        <h1>I'm Sorry, Apoorva.</h1>
        <div class="quote-block">
            "Apoorva, you're 5'5", dusky, and honestly the most patient person I know. 
            I know my 5'8" self does way too many <strong>harkate</strong>—it's just in my nature to be this way, 
            but it's never my intention to upset you. I might not say it out loud often, 
            but I care about every single detail that matters to you. 
            When you're not happy, my world just feels grayscale. 
            Can we go back to being besties?"
        </div>
        <p style="opacity: 0.6; font-style: italic;">Scroll down... I made this for you.</p>
    </header>

    <!-- Game 1: The Mood Mirror -->
    <section id="moodSection">
        <h2>How is the bestie feeling?</h2>
        <p>Your mood literally changes the color of this website.</p>
        <div>
            <button class="choice-btn" style="position:relative; margin:10px;" onclick="updateSession('mood', 'Sad')">I'm Upset/Sad</button>
            <button class="choice-btn" style="position:relative; margin:10px; background:var(--accent);" onclick="updateSession('mood', 'Happy')">I'm Okay/Happy</button>
        </div>
        <p id="moodResponse" style="margin-top: 30px; font-weight: 600;"></p>
    </section>

    <!-- The Polaroid Wall -->
    <section style="min-height: auto; background: #fefae0;">
        <h2>A Gallery of the Best Human</h2>
        <div class="polaroid-container" id="gallery">
            <!-- Photos will be injected here via JS -->
        </div>
        <div class="quote-block" style="margin-top: -50px;">
            "You have this amazing humor that saves our friendship every time I mess up. 
            I'm truly sorry for all the times I didn't mention how much I value you."
        </div>
    </section>

    <!-- Game 2: Harkate Stopper -->
    <section>
        <h2>The "Stop Shashwat" Game</h2>
        <p>I'm doing too many harkate! Click them to make them vanish.</p>
        <div class="game-area">
            <div id="harkate-canvas"></div>
            <p>Harkate Tolerated: <span id="hScore">0</span></p>
        </div>
    </section>

    <!-- Final Section -->
    <section class="decision-section">
        <h2>Final Verdict?</h2>
        <p>Will you forgive your annoying 5'8" bestie?</p>
        <div class="btn-wrap">
            <button class="choice-btn" id="yesBtn" onclick="finishSession()">Yes, Bestie!</button>
            <button class="choice-btn" id="noBtn" onmouseover="dodge()">No</button>
        </div>
    </section>

    <script>
        // --- 1. FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyBIyIXYNvVhJnSK58rB29K9n7SNnbaoqnc",
            authDomain: "proposal-apoorva-sarvagy.firebaseapp.com",
            databaseURL: "https://proposal-apoorva-sarvagy-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "proposal-apoorva-sarvagy",
            storageBucket: "proposal-apoorva-sarvagy.firebasestorage.app",
            messagingSenderId: "794226715688",
            appId: "1:794226715688:web:284222db7af709b2cd591d",
            measurementId: "G-BZ4R12MR9T"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // One Response Per Session Logic
        const sessionId = "session_" + Date.now();
        let sessionData = {
            name: "Apoorva Maurya",
            startTime: new Date().toLocaleString(),
            mood: "Not selected",
            harkateScore: 0,
            finalDecision: "Pending",
            noButtonAttempts: 0
        };

        function updateSession(key, value) {
            sessionData[key] = value;
            if(key === 'mood') {
                const body = document.getElementById('pageBody');
                const resp = document.getElementById('moodResponse');
                if(value === 'Sad') {
                    body.classList.add('grayscale');
                    resp.innerText = "Everything turned gray because you're sad. I can't stand it.";
                } else {
                    body.classList.remove('grayscale');
                    resp.innerText = "That's my bestie! Your glow is back! ✨";
                }
            }
            // Update the single record in apology_responses
            db.ref('apology_responses/' + sessionId).set(sessionData);
        }

        // --- 2. CREATIVE GALLERY LOGIC ---
        const gallery = document.getElementById('gallery');
        for(let i=1; i<=11; i++) {
            const div = document.createElement('div');
            div.className = 'polaroid';
            const ext = (i === 11) ? 'jpg' : 'png';
            div.innerHTML = `<img src="res/image-${i}.${ext}"><p style="font-family:'Dancing Script'; margin:10px 0 0 0;">Memory #${i}</p>`;
            
            // Random placement
            const x = Math.random() * 70; 
            const y = Math.random() * 70;
            const rot = (Math.random() * 40) - 20;
            div.style.left = x + '%';
            div.style.top = y + '%';
            div.style.transform = `rotate(${rot}deg)`;
            
            gallery.appendChild(div);
        }

        // --- 3. HARKATE GAME ---
        const canvas = document.getElementById('harkate-canvas');
        const phrases = ["Annoying Joke", "Bad Logic", "Random Text", "Late Reply", "Height Flex", "Extreme Harkat"];
        let score = 0;

        function spawnHarkat() {
            const h = document.createElement('div');
            h.className = 'h-bubble';
            h.innerText = phrases[Math.floor(Math.random()*phrases.length)];
            h.style.left = Math.random() * 80 + '%';
            h.style.top = Math.random() * 80 + '%';
            h.onclick = () => {
                score++;
                document.getElementById('hScore').innerText = score;
                updateSession('harkateScore', score);
                h.remove();
            };
            canvas.appendChild(h);
            setTimeout(() => { if(h) h.remove(); }, 2500);
        }
        setInterval(spawnHarkat, 1200);

        // --- 4. FINAL BUTTONS ---
        function dodge() {
            const btn = document.getElementById('noBtn');
            btn.style.position = 'fixed';
            btn.style.left = Math.random() * 80 + 'vw';
            btn.style.top = Math.random() * 80 + 'vh';
            sessionData.noButtonAttempts++;
            updateSession('noButtonAttempts', sessionData.noButtonAttempts);
        }

        function finishSession() {
            updateSession('finalDecision', 'Forgiven ❤️');
            alert("Yay! Besties forever! I'll try to keep the harkate low today.");
            document.body.innerHTML = `<div style="height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background:var(--bg); text-align:center;">
                <h1>❤️ Forgiven! ❤️</h1>
                <p>Thank you Apoorva. You're actually the best.</p>
            </div>`;
        }

        // Initial sync
        db.ref('apology_responses/' + sessionId).set(sessionData);
    </script>
</body>
</html>
